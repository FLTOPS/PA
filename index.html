<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Air Premia - PA Script (DST 지원)</title>

  <!-- 매니페스트 연결 (프로젝트 페이지라면 ./manifest.json 권장) -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png">
  <meta name="theme-color" content="#182749">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --ap-navy: #00264d;
            --ap-gold: #c5a059;
            --bg: #f2f4f7;
            --white: #ffffff;
            --text-dark: #1a1a1a;
            --highlight-color: #e67e22;
        }

        body.dark-mode {
            --bg: #121212;
            --white: #1e1e1e;
            --text-dark: #e0e0e0;
            --highlight-color: #ff9f43;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text-dark);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s;
        }

        .tab-header-container {
            display: flex;
            align-items: center;
            background: var(--ap-navy);
            padding: 0 15px;
            height: 60px;
            gap: 15px;
            flex-shrink: 0;
        }

        .tab-group { display: flex; height: 100%; gap: 5px; }

        .tab-btn {
            background: transparent;
            border: none;
            color: #95a5a6;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            padding: 0 40px; 
            height: 100%;
            border-bottom: 4px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active { color: white; border-bottom: 4px solid var(--ap-gold); }

        .tab-inner-controls {
            background: var(--white);
            padding: 15px 40px;
            border-bottom: 1px solid #ddd;
            display: none;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--text-dark);
        }
        .tab-inner-controls.active { display: flex; }
        
        .tab-inner-controls select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: var(--white);
            color: var(--text-dark);
        }

        .chk-group { display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .chk-group input { width: 16px; height: 16px; cursor: pointer; }

        .name-inputs { display: flex; align-items: center; gap: 8px; flex: 1; justify-content: flex-end; padding-right: 15px; }
        .name-inputs input {
            width: 80px;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.15);
            color: white;
            font-size: 0.85rem;
            outline: none;
        }

        .utility-group { display: flex; gap: 12px; align-items: center; }
        .btn-tool {
            padding: 4px 10px;
            border: 1px solid var(--ap-gold);
            border-radius: 4px;
            background: transparent;
            color: var(--ap-gold);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .content-area { flex: 1; display: none; grid-template-columns: 1fr 1fr; background: #7f8c8d; gap: 1px; overflow: hidden; }
        .content-area.active { display: grid; }

        .pane { padding: 40px; background: var(--white); overflow-y: auto; }
        
        .script { font-size: 1.8rem; line-height: 1.6; word-break: keep-all; }
        .script br { content: ""; display: block; margin-top: 15px; } 
        
        .script-en { font-size: 1.6rem; font-style: italic; opacity: 0.9; line-height: 1.6; }
        .script-en br { margin-top: 12px; }

        .highlight { color: var(--highlight-color); font-weight: 800; border-bottom: 2px solid var(--highlight-color); }
        .hidden { display: none !important; }

        /* DST 텍스트 색상 조절 */
        .dst-label { color: var(--ap-gold); font-size: 0.75rem; font-weight: bold; display: flex; align-items: center; gap: 4px; }
    </style>
</head>
<body>

    <div class="tab-header-container">
        <div class="tab-group">
            <button class="tab-btn active" id="btn-welcome" onclick="setTab('welcome')">WELCOME</button>
            <button class="tab-btn" id="btn-arrival" onclick="setTab('arrival')">ARRIVAL</button>
        </div>

        <div class="name-inputs">
            <input type="text" id="nameKorInput" placeholder="이름(한글)" oninput="updateAll()">
            <input type="text" id="nameEngInput" placeholder="성(영문)" oninput="updateAll()">
        </div>

        <div class="utility-group">
            <label class="dst-label">
                <input type="checkbox" id="dstCheck" onchange="updateAll()"> DST
            </label>
            <button class="btn-tool" onclick="toggleDarkMode()">NIGHT</button>
            <button class="btn-tool" onclick="resetSettings()">RESET</button>
        </div>
    </div>

    <div id="set-welcome-inner" class="tab-inner-controls active">
        <span>Departure:</span> <select id="depSelect"></select>
        <span>Destination:</span> <select id="destSelect"></select>
        <span>비행시간:</span> <select id="hSel"></select>시 <select id="mSel"></select>분
    </div>

    <div id="set-arrival-inner" class="tab-inner-controls">
        <span>날씨:</span>
        <select id="weatherSelect">
            <option value="맑으며">맑으며</option>
            <option value="흐리며">흐리며</option>
            <option value="비가 오고 있으며">비가 오고 있으며</option>
            <option value="눈이 오고 있으며">눈이 오고 있으며</option>
            <option value="안개가 끼어 있으며">안개가 끼어 있으며</option>
        </select>
        <span>기온:</span> <select id="tempSelect"></select>℃
        <label class="chk-group">
            <input type="checkbox" id="shakeCheck" onchange="updateAll()"> 흔들림
        </label>
    </div>

    <div id="welcome" class="content-area active">
        <div class="pane">
            <div class="script">
                승객 여러분, 안녕하십니까? <br>
                저는 기장 <span id="korNameSpan"></span>입니다. <br>
                에어프레미아를 이용해 주셔서 감사합니다. <br>
                오늘 <span class="highlight dest-text">목적지</span>공항까지의 예상 비행 시간은 <span class="highlight" id="korTimeDuration">시간 미설정</span>입니다. <br>
                저와 전 승무원들이 최선을 다해 안전하게 모시겠습니다. <br>
                고맙습니다.
            </div>
        </div>
        <div class="pane">
            <div class="script script-en">
                <span id="engGreetingWelcome">Good Morning</span>, Ladies and Gentlemen. <br>
                This is Captain <span id="engNameSpan"></span> speaking. <br>
                Welcome aboard Air Premia. <br>
                The flight to <span class="highlight dest-text">Destination</span> Airport will take <span class="highlight" id="engTimeDuration">__ hours</span>. <br>
                Thank you for flying with us, and enjoy the flight.
            </div>
        </div>
    </div>

<div id="arrival" class="content-area">
        <div class="pane">
            <div class="script">
                손님 여러분, 저는 기장입니다. <br>
                <span id="korGreeting">편안한 비행되셨습니까?</span> <br>
                우리는 앞으로 약 40분 후에 목적지 <span class="highlight dest-text">목적지</span>공항에 착륙할 예정입니다.<span id="korTimeSpan"><br>지금 이곳은 <span class="highlight" id="currentDateKor">1월 1일 월요일</span> <span class="highlight" id="currentTimeKor">오후 12시 00분</span>입니다.</span> <br>
                <span class="highlight dest-text">목적지</span>공항의 날씨는 <span class="highlight weather-text">맑으며</span>, 기온은 섭씨 <span class="highlight temp-text">20</span>도 입니다. <br>
                소중한 여행을 저희 에어프레미아와 함께 해 주셔서 감사드립니다. <br>
                아무쪼록 가시는 목적지까지 안전하고 즐거운 여행이 되시기 바랍니다. <br>
                고맙습니다.
            </div>
        </div>
        <div class="pane">
            <div class="script script-en">
                Ladies and Gentlemen, This is captain speaking. <br>
                <span id="engGreetingArrival">We hope you have enjoyed the flight.</span> <br>
                We are about 40 minutes away from <span class="highlight dest-text">Destination</span> airport. <span id="engTimeSpan"><br>Local Time now is <span class="highlight" id="currentTimeEn">12:00 PM</span> <span class="highlight" id="currentDateEn">on Monday, January 1</span>.</span> <br>
                At the airport, it's <span class="highlight weather-en-text">clear</span>. <br>
                And the temperature is <span class="highlight temp-text">20</span><span class="highlight">℃</span>, or <span class="highlight" id="tempF">68</span><span class="highlight">℉</span>. <br>
                Once again, Thank you for flying Air Premia<br>
                and we hope to see you again on your next trip.
            </div>
        </div>
    </div>

    <script>
        const elements = {
            dep: document.getElementById('depSelect'),
            dest: document.getElementById('destSelect'),
            h: document.getElementById('hSel'),
            m: document.getElementById('mSel'),
            weather: document.getElementById('weatherSelect'),
            temp: document.getElementById('tempSelect'),
            shake: document.getElementById('shakeCheck'),
            dst: document.getElementById('dstCheck'), // DST 추가
            nameKor: document.getElementById('nameKorInput'),
            nameEng: document.getElementById('nameEngInput')
        };

        const airports = [
            { name: "서울, 인천", offset: 0 },
            { name: "로스엔젤레스", offset: -17 },
            { name: "뉴왁, 리버티", offset: -14 },
            { name: "샌프란시스코", offset: -17 },
            { name: "워싱턴, 덜레스", offset: -14 },
            { name: "도쿄, 나리타", offset: 0 },
            { name: "방콕, 스완나품", offset: -2 },
            { name: "다낭", offset: -2 },
            { name: "홍콩", offset: -1 },
            { name: "호놀룰루, 이노우에", offset: -19 },
            { name: "싱가포르, 창이", offset: -1 }
        ];

        airports.forEach(ap => {
            let depOpt = new Option(ap.name, ap.name); depOpt.dataset.offset = ap.offset;
            elements.dep.add(depOpt);
        });

        elements.dest.add(new Option("선택하세요", ""));
        airports.forEach(ap => {
            let destOpt = new Option(ap.name, ap.name); destOpt.dataset.offset = ap.offset;
            elements.dest.add(destOpt);
        });

        elements.h.add(new Option(" ", ""));
        for(let i=1; i<=16; i++) elements.h.add(new Option(i, i));
        elements.m.add(new Option(" ", ""));
        for(let i=0; i<60; i+=5) elements.m.add(new Option(i, i));

        for(let i=-25; i<=45; i++) {
            let opt = new Option(i, i); if(i === 20) opt.selected = true;
            elements.temp.add(opt);
        }

        function updateAll() {
            const destName = elements.dest.value || "목적지";
            const hVal = elements.h.value;
            const mVal = elements.m.value;
            const weatherKo = elements.weather.value;
            const tempC = parseInt(elements.temp.value);
            const depOffset = parseInt(elements.dep.options[elements.dep.selectedIndex].dataset.offset || 0);
            const destOffset = parseInt(elements.dest.options[elements.dest.selectedIndex]?.dataset.offset || 0);
            
            // DST 보정: 체크 시 1시간 추가
            const dstAdjustment = elements.dst.checked ? 1 : 0;

            document.getElementById('korNameSpan').innerText = elements.nameKor.value;
            document.getElementById('engNameSpan').innerText = elements.nameEng.value.toUpperCase();

            const sysHour = new Date().getHours();
            let greeting = "Good Evening";
            if (sysHour >= 5 && sysHour < 12) greeting = "Good Morning";
            else if (sysHour >= 12 && sysHour < 18) greeting = "Good Afternoon";
            document.getElementById('engGreetingWelcome').innerText = greeting;

            document.querySelectorAll('.dest-text').forEach(el => el.innerText = destName);

            if (hVal === "" && mVal === "") {
                document.getElementById('korTimeDuration').innerText = "시간 미설정";
                document.getElementById('engTimeDuration').innerText = "__ hours";
            } else {
                const h = parseInt(hVal || 0);
                const m = parseInt(mVal || 0);
                document.getElementById('korTimeDuration').innerText = m > 0 ? `${h}시간 ${m}분` : `${h}시간`;
                document.getElementById('engTimeDuration').innerText = m > 0 ? `${h} hours and ${m} mins` : `${h} hours`;
            }

            document.querySelectorAll('.weather-text').forEach(el => el.innerText = weatherKo);
            const weatherMapEn = { "맑으며": "clear", "흐리며": "cloudy", "비가 오고 있으며": "rainy", "눈이 오고 있으며": "snowy", "안개가 끼어 있으며": "foggy" };
            document.querySelectorAll('.weather-en-text').forEach(el => el.innerText = weatherMapEn[weatherKo]);
            document.querySelectorAll('.temp-text').forEach(el => el.innerText = tempC);
            document.getElementById('tempF').innerText = Math.round(tempC * 1.8 + 32);

            if(elements.shake.checked) {
                document.getElementById('korGreeting').innerText = "오늘 기류 영향으로 비행기가 많이 흔들렸습니다. 이점 널리 양해 바랍니다.";
                document.getElementById('engGreetingArrival').innerText = "The ride was quite bumpy today, we ask for your understanding.";
            } else {
                document.getElementById('korGreeting').innerText = "편안한 비행되셨습니까?";
                document.getElementById('engGreetingArrival').innerText = "We hope you have enjoyed the flight.";
            }

            // 도착지 현지 시간 계산 (DST 반영)
            if (depOffset === destOffset || elements.dest.value === "") {
                document.getElementById('korTimeSpan').classList.add('hidden');
                document.getElementById('engTimeSpan').classList.add('hidden');
            } else {
                document.getElementById('korTimeSpan').classList.remove('hidden');
                document.getElementById('engTimeSpan').classList.remove('hidden');
                
                const now = new Date();
                const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                const localTime = new Date(utc + (3600000 * (9 + destOffset + dstAdjustment)));
                
                // 시간 표시
                document.getElementById('currentTimeKor').innerText = `${localTime.getHours() >= 12 ? "오후" : "오전"} ${localTime.getHours() % 12 || 12}시 ${localTime.getMinutes().toString().padStart(2, '0')}분`;
                document.getElementById('currentTimeEn').innerText = localTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });

                // 날짜 표시 (한글: 월 일 요일)
                const daysKor = ["일", "월", "화", "수", "목", "금", "토"];
                document.getElementById('currentDateKor').innerText = `${localTime.getMonth() + 1}월 ${localTime.getDate()}일 ${daysKor[localTime.getDay()]}요일`;

                // 날짜 표시 (영문: on day, month, date)
                const daysEn = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                const monthsEn = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                document.getElementById('currentDateEn').innerText = `on ${daysEn[localTime.getDay()]}, ${monthsEn[localTime.getMonth()]} ${localTime.getDate()}`;
            }
            saveSettings();
        }

        function setTab(id) {
            document.querySelectorAll('.content-area, .tab-btn, .tab-inner-controls').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-' + id).classList.add('active');
            document.getElementById('set-' + id + '-inner').classList.add('active');
            updateAll();
        }

        function saveSettings() {
            const settings = { darkMode: document.body.classList.contains('dark-mode') };
            for(let key in elements) settings[key] = (key === 'shake' || key === 'dst') ? elements[key].checked : elements[key].value;
            localStorage.setItem('ap_settings_v22', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('ap_settings_v22');
            if(saved) {
                const s = JSON.parse(saved);
                for(let key in elements) {
                    if(s[key] !== undefined) {
                        if(key === 'shake' || key === 'dst') elements[key].checked = s[key];
                        else elements[key].value = s[key];
                    }
                }
                if(s.darkMode) document.body.classList.add('dark-mode');
            }
            updateAll();
        }

        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); saveSettings(); }

        function resetSettings() {
            elements.dep.value = "서울, 인천";
            elements.dest.value = "";
            elements.h.value = ""; 
            elements.m.value = ""; 
            elements.temp.value = 20;
            elements.weather.value = "맑으며";
            elements.shake.checked = false;
            elements.dst.checked = false; // DST 초기화
            updateAll();
        }

        for(let key in elements) elements[key].addEventListener('change', updateAll);
        window.onload = loadSettings;
        setInterval(updateAll, 60000);
    </script>

  <!-- 서비스 워커 등록 -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js")
          .then(reg => console.log("Service Worker registered:", reg))
          .catch(err => console.error("Service Worker registration failed:", err));
      });
    }
  </script>

</body>
</html>